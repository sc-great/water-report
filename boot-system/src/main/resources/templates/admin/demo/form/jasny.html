<!DOCTYPE html>
<html lang="zh">
<head>
	<th:block th:include="admin/include :: header('功能扩展')" />
</head>
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-sm-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>文件上传控件 <small>https://github.com/jasny/bootstrap</small></h5>
                    </div>
                    <div class="ibox-content">
                    	<div class="form-group">
                            <label class="font-noraml">输入组示例</label>
                            <div id="input_upload"></div>
                        </div>
                        
                        <div class="form-group">
                            <label class="font-noraml">按钮示例</label>
                            <br/>
	                        <div class="fileinput fileinput-new" data-provides="fileinput">
	                            <span class="btn btn-white btn-file">
                                    <span class="fileinput-new">选择文件</span>
                                    <span class="fileinput-exists">更改</span>
                                    <input type="file" name="...">
                                </span>
	                            <span class="fileinput-filename"></span>
	                            <a href="#" class="close fileinput-exists" data-dismiss="fileinput" style="float: none">&times;</a>
	                        </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="font-noraml">图片上传示例</label>
                            <br/>
	                        <div class="fileinput fileinput-new" data-provides="fileinput">
					            <div class="fileinput-preview thumbnail" data-trigger="fileinput" style="width: 200px; height: 150px;"></div>
					            <div>
					                <span class="btn btn-white btn-file">
                                        <span class="fileinput-new">选择图片</span>
                                        <span class="fileinput-exists">更改</span>
                                        <input type="file">
                                    </span>
					                <a href="#" class="btn btn-white fileinput-exists" data-dismiss="fileinput">清除</a>
					            </div>
					        </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="font-noraml">图片预览示例</label>
                            <br/>
	                        <div class="fileinput fileinput-new" data-provides="fileinput">
						        <div class="fileinput-new thumbnail" style="width: 140px; height: 140px;">
						          <img th:src="@{/img/profile.jpg}">
						        </div>
						        <div class="fileinput-preview fileinput-exists thumbnail" style="max-width: 200px; max-height: 150px;"></div>
						        <div>
						          <span class="btn btn-white btn-file"><span class="fileinput-new">选择图片</span><span class="fileinput-exists">更改</span><input type="file"></span>
						          <a href="#" class="btn btn-white fileinput-exists" data-dismiss="fileinput">清除</a>
						        </div>
						      </div>
                        </div>
                        <hr>
                        <div class="form-group">
                            <label class="font-noraml">相关参数详细信息</label>
                            <div><a href="http://doc.ruoyi.vip/#/standard/zjwd?id=jasny-bootstrap" target="_blank">http://doc.ruoyi.vip/#/standard/zjwd?id=jasny-bootstrap</a></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>固定格式文本 <small>https://github.com/jasny/bootstrap</small></h5>
                    </div>
                    <div class="ibox-content">
                        <div class="form-group">
                            <label class="font-noraml">手机号码格式</label>
                             <input type="text" class="form-control" data-mask="999-9999-9999" placeholder="请输入手机号码">
                             <span class="help-block">158-8888-88888</span>
                       	 </div>
                        
                        <div class="form-group">
                            <label class="font-noraml">电话号码格式</label>
                            <input type="text" class="form-control" data-mask="9999-9999999" placeholder="请输入电话号码">
                            <span class="help-block">0730-8888888</span>
                        </div>
                        
                        <div class="form-group">
                            <label class="font-noraml">日期格式</label>
                            <input type="text" class="form-control" data-mask="9999-99-99" placeholder="请输入日期格式">
                            <span class="help-block">yyyy-mm-dd</span>
                        </div>
                        
                        <div class="form-group">
                            <label class="font-noraml">IPV4格式</label>
                            <input type="text" class="form-control" data-mask="999.999.999.999" placeholder="请输入IP地址">
                            <span class="help-block">192.168.100.200</span>
                        </div>
                        
                        <div class="form-group">
                            <label class="font-noraml">税务代码格式</label>
                            <input type="text" class="form-control" data-mask="99-9999999" placeholder="请输入税务代码">
                            <span class="help-block">99-9999999</span>
                        </div>
                        <hr>
                        <div class="form-group">
                            <label class="font-noraml">相关参数详细信息</label>
                            <div><a href="http://doc.ruoyi.vip/#/standard/zjwd?id=jasny-bootstrap" target="_blank">http://doc.ruoyi.vip/#/standard/zjwd?id=jasny-bootstrap</a></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <th:block th:include="admin/include :: common" />
    <th:block th:include="admin/include :: jasny-bootstrap" />
    <script th:inline="javascript">
        $(function(){
            var params={
                container:"#input_upload",
                //value:{id:"48f6fabeef1a11e99ad700248cb2ef10",type:"image",name: "1.jpg",size: 2613, path: "/profile/default/2019/10/15/be65e42a18315e0341add7050d767e16.jpg"}
            };
            initUpload(params);
        });
        function initUpload(params){
            var tools={
                container:"",
                type:"input",
                file_name:"input_file",
                accept:".jpg,.jpeg,.gif,.png,.doc,.docx,.xls,.xlsx,.pdf",
                width:120,
                height:120,
                value:""
            };
            $.extend(tools,params);
            var inputType=tools.type;
            var html='';
            var name="";
            var id="";
            var className="";
            if(tools.value!=""){
                name=tools.value.name;
                id=tools.value.id;
                className="fileinput-exists";
            }
            if(inputType=="input"){
                html='<div class="fileinput input-group '+(className==""?"fileinput-new":className)+'" data-provides="fileinput">\n' +
                    '       <div class="form-control" data-trigger="fileinput">\n' +
                    '           <i class="glyphicon glyphicon-file fileinput-exists"></i>\n' +
                    '           <span class="fileinput-filename">'+name+'</span>\n' +
                    '       </div>\n' +
                    '       <span class="input-group-addon btn btn-white btn-file">\n' +
                    '           <span class="fileinput-new">选择文件</span>\n' +
                    '           <span class="fileinput-exists">更改</span>\n' +
                    '           <input type="hidden" name="'+tools.file_name+'" value="'+id+'">'+
                    '           <input type="file" id="'+tools.file_name+'" name="'+tools.file_name+'" accept="'+tools.accept+'">\n' +
                    '       </span>\n' +
                    '       <a href="#" class="input-group-addon btn btn-white fileinput-exists clearfile" data-dismiss="fileinput">清除</a>\n' +
                    '</div>';
            }else if(inputType=="button"){
                html='<div class="fileinput '+(className==""?"fileinput-new":className)+'" data-provides="fileinput">\n' +
                    '    <span class="btn btn-white btn-file">\n' +
                    '        <span class="fileinput-new">选择文件</span>\n' +
                    '        <span class="fileinput-exists">更改</span>\n' +
                    '        <input type="hidden" name="'+tools.file_name+'" value="'+id+'">'+
                    '        <input type="file" id="'+tools.file_name+'" name="'+tools.file_name+'" accept="'+tools.accept+'">\n' +
                    '    </span>\n' +
                    '    <span class="fileinput-filename">'+name+'</span>\n' +
                    '    <a href="#" class="close fileinput-exists clearfile" data-dismiss="fileinput" style="float: none">&times;</a>\n' +
                    '</div>';
            }else if(inputType=="preview"){
                var img="";
                if(tools.value!=""){
                    img='<img src="'+tools.value.path+'">';
                }
                html='<div class="fileinput '+(className==""?"fileinput-new":className)+'" data-provides="fileinput">\n' +
                    '    <div class="fileinput-preview thumbnail" data-trigger="fileinput" style="width: '+tools.width+'px; height: '+tools.height+'px;">'+img+'</div>\n' +
                    '    <div>\n' +
                    '        <span class="btn btn-white btn-file">\n' +
                    '            <span class="fileinput-new">选择图片</span>\n' +
                    '            <span class="fileinput-exists">更改</span>\n' +
                    '            <input type="hidden" name="'+tools.file_name+'" value="'+id+'">'+
                    '            <input type="file" id="'+tools.file_name+'" name="'+tools.file_name+'" accept=".jpg,.jpeg,.gif,.png">\n' +
                    '        </span>\n' +
                    '        <a href="#" class="btn btn-white fileinput-exists clearfile" data-dismiss="fileinput">清除</a>\n' +
                    '    </div>\n' +
                    '</div>';
            }
            var objHTML=$(html);
            objHTML.find("input[type=file][name="+tools.file_name+"]").bind("change",function(){
                var file=$(this)[0].files[0];
                var formData = new FormData();
                formData.append('uploadfile', file);
                var id=$("input[type=hidden][name="+tools.file_name+"]").val();
                if(id!=""){
                    $.ajax({
                        async:false,
                        url:"/system/files/doDelete",
                        type:"post",
                        data:{id:id},
                        success:function(result){
                            if(result.code==0){
                                var id=result.data;
                                $("input[type=hidden][name="+tools.file_name+"]").val("");
                            }
                        }
                    });
                }
                $.ajax({
                    type:"post",
                    url:"/system/files/doUpload",
                    data:formData,
                    dataType: "json",
                    mimeType: "multipart/form-data",
                    async:false,
                    cache: false, //上传文件不需要缓存
                    contentType: false, //需设置为false。因为是FormData对象，且已经声明了属性enctype="multipart/form-data"
                    processData: false, //需设置为false。因为data值是FormData对象，不需要对数据做处理
                    success:function(result){
                        if(result.code==0){
                            var id=result.data;
                            $("input[type=hidden][name="+tools.file_name+"]").val(id);
                        }
                    }
                });
            });
            objHTML.find(".clearfile").bind("click",function(){
                var id=$("input[type=hidden][name="+tools.file_name+"]").val();
                if(id!=""){
                    $.ajax({
                        url:"/system/files/doDelete",
                        type:"post",
                        data:{id:id},
                        success:function(result){
                            if(result.code==0){
                                var id=result.data;
                                $("input[type=hidden][name="+tools.file_name+"]").val("");
                            }
                        }
                    });
                }
            });
            $(tools.container).append(objHTML);
        }
    </script>
</body>
</html>
